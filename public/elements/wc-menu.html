<dom-module id="wc-menu">
    <template>
        <style is="custom-style">
        paper-drawer-panel {
            --paper-drawer-panel-main-container: {
                background-color: rgb(184, 255, 184);
            }
            ;
            --paper-drawer-panel-left-drawer-container: {
                background-color: rgb(2, 158, 2);
            }
            ;
            --paper-drawer-panel-scrim: {
                background-color: rgb(184, 255, 184);
            }
            ;
        }

        paper-menu {
            --paper-menu-background-color: rgb(124, 247, 124);
            padding: 0;
        }

        .div-paper-toolbar {
            background-color: #039003;
            border-bottom: 5px solid black;
            color: black;
            font-size: 20px;
            font-weight: bold;
        }

        .div-colection {
            background-color: grey;
            color: black;
            border-radius: 10px;
            border: 5px solid black;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .div-carrito {
            margin: 20px;
            background-color: #7CF77C;
            color: black;
            border-radius: 10px;
            border: 5px solid black;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .div-subcategorie {
            padding: 20px;
        }

        .title-subcategorie {
            /*text-align: center;
            margin:20px;*/
        }

        .item-category {
            border: 2px solid black;
        }

        .title {
            font-size: 20px !important;
            font-weight: bold !important;
            width: 100%;
        }

        .carrito {
            background-color: rgb(124, 247, 124);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
        }
        
        </style>
        <iron-ajax auto url="/api/colec-name" handle-as="json" on-response="handleResponse" debounce-duration="300"></iron-ajax>
        <iron-ajax auto url="/api/colec-sub/?sub={{selectedCategorie}}" handle-as="json" on-response="handleSubcat" debounce-duration="300"></iron-ajax>
        <paper-drawer-panel>
            <paper-header-panel drawer>
                <paper-toolbar class="div-paper-toolbar">
                    <div>Categories</div>
                </paper-toolbar>
                <paper-menu id="menu">
                    <template is="dom-repeat" items="{{categories}}" as="categorie">
                        <paper-item class="item-category" on-tap="onBtnTap" id="{{index}}" value={{categorie}}>{{categorie}}</paper-item>
                    </template>
                </paper-menu>
            </paper-header-panel>
            <paper-header-panel main id="panelheader">
                <paper-toolbar class="div-paper-toolbar">
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <div class="title">Comic Shop Babel</div>
                    <div on-tap="onCarrtap" class="carrito">Carrito: {{numItemsCarrito}} items
                    </div>
                </paper-toolbar>
                <template is="dom-if" if="{{subIsieSelected}}">
                    <div class="div-subcategorie">
                        <template is="dom-if" if="{{!isSelected}}">
                            <h1>Bienvenido a Comic Shop Babel</h1>
                        </template>
                        <template is="dom-if" if="{{isSelected}}">
                            <h1>Categoria{{selectedCategorie}}</h1>
                            <template is="dom-repeat" items="{{subcategories}}" as="subcat">
                                <div class="div-colection">
                                    <h1 class=>{{subcat}}</h1>
                                    <wc-subcategories data={{subcat}}>
                                        <span></span>
                                    </wc-subcategories>
                                    <br>
                                </div>
                            </template>
                        </template>
                    </div>
                </template>
                <template is="dom-if" if="{{carritoSelected}}">
                    <div class="div-carrito">
                        <h1>Carrito</h1>
                        <wc-carrito numItems={{numItemsCarrito}} data={{itemsCarrito}}></wc-carrito>
                    </div>
                </template>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
    <script>
    (function() {
        WCMenu = Polymer({
            is: 'wc-menu',
            properties: {
                categories: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                },
                subcategories: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                },
                selectedCategorie: {
                    type: String,
                    value: ""
                },
                carritoSelected: {
                    type: Boolean,
                    value: false
                },
                isSelected: {
                    type: Boolean,
                    value: false
                },
                subIsieSelected: {
                    type: Boolean,
                    value: true
                },
                numItemsCarrito: {
                    type: Number,
                    value: 0
                },
                itemsCarrito: {
                    type: Array,
                    value: function(){
                        return [];
                    }
                }
            },
            ready: function() {

                // MANTENER EN LA VENTANA ->
                //this.itemsCarrito = JSON.parse(window.localStorage['carrito']);
                this.numItemsCarrito = this.itemsCarrito.length;

                this.addEventListener("itemBuy", function(e) {
                    this.itemsCarrito.push(e.detail);
                    this.numItemsCarrito = this.itemsCarrito.length;
                    window.localStorage['carrito'] = JSON.stringify(this.itemsCarrito);
                    console.log("Local", JSON.parse(window.localStorage['carrito']));
                });
                this.$.panelheader.parentNode.style.overflow = "scroll";
                this.$.panelheader.parentNode.style.overflowX = "hidden";

                this.addEventListener("moveSubcolection", function(e) {
                    // TODO: mover el carrosel
                    // e.detail.accion contiene la accion a realizar
                    // e.detail.subcolection contiene la subcolection a mover
                    console.log("moveSubcolection", e.detail);
                });
            },
            onCarrtap: function(e) {
                e.stopPropagation();
                this.subIsieSelected = false;
                this.carritoSelected = true;
                console.log("Evento onCarrtap,carritoSelected", this.carritoSelected);
                console.log("Evento onCarrtap,subIsieSelected", this.subIsieSelected)
            },
            onBtnTap: function(e) {
                e.stopPropagation();
                this.carritoSelected = false;
                this.subIsieSelected = true;
                console.log("Evento onBtnTap,carritoSelected", this.carritoSelected);
                console.log("Evento onBtnTap,subIsieSelected", this.subIsieSelected)
                this.isSelected = true;
                this.$.menu.selected = e.target.id;
                this.selectedCategorie = e.target.value;
                //this.subcategories = ["Spiderman", "Batman", "Superman"]; this.fire ('change', {title:this.title, time:e.target.value});
            },
            handleResponse: function(res, req, err) {
                this.categories = res.detail.response.names;
            },
            handleSubcat: function(res, req, err) {
                this.subcategories = res.detail.response.subcategories;
                console.log("subcategories", this.subcategories);
                console.log("selectedsubcat", this.selectedCategorie);
            }
        })

    })();
    </script>
</dom-module>
